@import '../core/style/variables';
@import '../core/style/checkbox-common';
@import '../core/theming/vdlPalette';


$vdl-checkbox-size: $vdl-toggle-size !default;
// The width of the line used to draw the checkmark / mixedmark.
$vdl-checkbox-mark-stroke-size: 2/15 * $vdl-checkbox-size !default;
$vdl-checkbox-border-width: 2px;
$vdl-checkbox-transition-duration: 90ms;
$vdl-checkbox-item-spacing: $vdl-toggle-padding;
$checkbox-border-color: vdl-color(7);
$checkbox-mark-color: vdl-color(0);

$checkbox-border-radius: 3px;

// Manual calculation done on SVG
$_vdl-checkbox-mark-path-length: 22.910259;
$_vdl-checkbox-indeterminate-checked-easing-function: cubic-bezier(0.14, 0, 0, 1);

$disabled-color: vdl-color(6);

// Fades in the background of the checkbox when it goes from unchecked -> {checked,indeterminate}.
@keyframes vdl-checkbox-fade-in-background {
  0% {
    opacity: 0;
  }

  50% {
    opacity: 1;
  }
}

// Fades out the background of the checkbox when it goes from {checked,indeterminate} -> unchecked.
@keyframes vdl-checkbox-fade-out-background {
  0%, 50% {
    opacity: 1;
  }

  100% {
    opacity: 0;
  }
}

// "Draws" in the checkmark when the checkbox goes from unchecked -> checked.
@keyframes vdl-checkbox-unchecked-checked-checkmark-path {
  0%, 50% {
    stroke-dashoffset: $_vdl-checkbox-mark-path-length;
  }

  50% {
    animation-timing-function: $vdl-linear-out-slow-in-timing-function;
  }

  100% {
    stroke-dashoffset: 0;
  }
}

// Horizontally expands the mixedmark when the checkbox goes from unchecked -> indeterminate.
@keyframes vdl-checkbox-unchecked-indeterminate-mixedmark {
  0%, 68.2% {
    transform: scaleX(0);
  }

  68.2% {
    animation-timing-function: cubic-bezier(0, 0, 0, 1);
  }

  100% {
    transform: scaleX(1);
  }
}

// "Erases" the checkmark when the checkbox goes from checked -> unchecked.
@keyframes vdl-checkbox-checked-unchecked-checkmark-path {
  from {
    animation-timing-function: $vdl-fast-out-linear-in-timing-function;
    stroke-dashoffset: 0;
  }

  to {
    stroke-dashoffset: $_vdl-checkbox-mark-path-length * -1;
  }
}


// Rotates and fades out the checkmark when the checkbox goes from checked -> indeterminate. This
// animation helps provide the illusion of the checkmark "morphing" into the mixedmark.
@keyframes vdl-checkbox-checked-indeterminate-checkmark {
  from {
    animation-timing-function: $vdl-linear-out-slow-in-timing-function;
    opacity: 1;
    transform: rotate(0deg);
  }

  to {
    opacity: 0;
    transform: rotate(45deg);
  }
}

// Rotates and fades the checkmark back into position when the checkbox goes from indeterminate ->
// checked. This animation helps provide the illusion that the mixedmark is "morphing" into the
// checkmark.
@keyframes vdl-checkbox-indeterminate-checked-checkmark {
  from {
    animation-timing-function: $_vdl-checkbox-indeterminate-checked-easing-function;
    opacity: 0;
    transform: rotate(45deg);
  }

  to {
    opacity: 1;
    transform: rotate(360deg);
  }
}

// Rotates and fades in the mixedmark when the checkbox goes from checked -> indeterminate. This
// animation, similar to vdl-checkbox-checked-indeterminate-checkmark, helps provide an illusion
// of "morphing" from checkmark -> mixedmark.
@keyframes vdl-checkbox-checked-indeterminate-mixedmark {
  from {
    animation-timing-function: $vdl-linear-out-slow-in-timing-function;
    opacity: 0;
    transform: rotate(-45deg);
  }

  to {
    opacity: 1;
    transform: rotate(0deg);
  }
}

// Rotates and fades out the mixedmark when the checkbox goes from indeterminate -> checked. This
// animation, similar to vdl-checkbox-indeterminate-checked-checkmark, helps provide an illusion
// of "morphing" from mixedmark -> checkmark.
@keyframes vdl-checkbox-indeterminate-checked-mixedmark {
  from {
    animation-timing-function: $_vdl-checkbox-indeterminate-checked-easing-function;
    opacity: 1;
    transform: rotate(0deg);
  }

  to {
    opacity: 0;
    transform: rotate(315deg);
  }
}


// Horizontally collapses and fades out the mixedmark when the checkbox goes from indeterminate ->
// unchecked.
@keyframes vdl-checkbox-indeterminate-unchecked-mixedmark {
  0% {
    animation-timing-function: linear;
    opacity: 1;
    transform: scaleX(1);
  }

  32.8%, 100% {
    opacity: 0;
    transform: scaleX(0);
  }
}

// Applied to elements that cover the checkbox's entire inner container.
%vdl-checkbox-cover-element {
  bottom: 0;
  left: 0;
  position: absolute;
  right: 0;
  top: 0;
}

// Applied to elements that are considered "marks" within the checkbox, e.g. the checkmark and
// the mixedmark.
%vdl-checkbox-mark {
  $width-padding-inset: 2 * $vdl-checkbox-border-width;
  width: calc(100% - #{$width-padding-inset});
}

// Applied to elements that appear to make up the outer box of the checkmark, such as the frame
// that contains the border and the actual background element that contains the marks.
%vdl-checkbox-outer-box {
  @extend %vdl-checkbox-cover-element;
  border-radius: $checkbox-border-radius;
  box-sizing: border-box;
  pointer-events: none;
}

vdl-checkbox {
  cursor: pointer;
  padding: 0;
  padding-bottom: 13px;
  display: inline-block;
}

.vdl-checkbox-layout {
  // `cursor: inherit` ensures that the wrapper element gets the same cursor as the vdl-checkbox
  // (e.g. pointer by default, regular when disabled), instead of the browser default.
  cursor: inherit;
  align-items: baseline;
  vertical-align: middle;
  display: inline-flex;
}

.vdl-checkbox-inner-container {
  display: inline-block;
  height: $vdl-checkbox-size;
  line-height: 0;
  margin: 2px $vdl-checkbox-item-spacing auto auto;
  order: 0;
  position: relative;
  vertical-align: middle;
  white-space: nowrap;
  width: $vdl-checkbox-size;
  flex-shrink: 0;

  [dir='rtl'] & {
    margin: {
      left: $vdl-checkbox-item-spacing;
      right: auto;
    }
  }
}

// TODO(kara): Remove this style when fixing vertical baseline
.vdl-checkbox-layout .vdl-checkbox-label-container {
  line-height: 24px;
}

.vdl-checkbox-frame {
  @extend %vdl-checkbox-outer-box;

  background-color: transparent;
  border: $vdl-checkbox-border-width solid;
  transition: border-color $vdl-checkbox-transition-duration $vdl-linear-out-slow-in-timing-function;
}

.vdl-checkbox-background {
  @extend %vdl-checkbox-outer-box;

  align-items: center;
  display: inline-flex;
  justify-content: center;
  transition: background-color $vdl-checkbox-transition-duration
                  $vdl-linear-out-slow-in-timing-function,
              opacity $vdl-checkbox-transition-duration $vdl-linear-out-slow-in-timing-function;
}

.vdl-checkbox-checkmark {
  @extend %vdl-checkbox-cover-element;
  @extend %vdl-checkbox-mark;

  width: 100%;
}

.vdl-checkbox-checkmark-path {
  stroke: {
    dashoffset: $_vdl-checkbox-mark-path-length;
    dasharray: $_vdl-checkbox-mark-path-length;
    width: $vdl-checkbox-mark-stroke-size;
  }
}

.vdl-checkbox-mixedmark {
  @extend %vdl-checkbox-mark;

  height: floor($vdl-checkbox-mark-stroke-size);
  opacity: 0;
  transform: scaleX(0) rotate(0deg);
}

.vdl-checkbox-label-before {
  .vdl-checkbox-inner-container {
    order: 1;
    margin: {
      left: $vdl-checkbox-item-spacing;
      right: auto;
    }

    [dir='rtl'] & {
      margin: {
        left: auto;
        right: $vdl-checkbox-item-spacing;
      }
    }
  }
  .vdl-checkbox-label-container {
    text-align: right;
  }
}

.vdl-checkbox-anim-unchecked-indeterminate {
  .vdl-checkbox-background {
    background-color: vdl-color(11);
  }
}

.vdl-checkbox-checked {
  .vdl-checkbox-background {
    background-color: vdl-color(11);
  }
  .vdl-checkbox-checkmark {
    opacity: 1;
  }

  .vdl-checkbox-checkmark-path {
    stroke-dashoffset: 0;
  }

  .vdl-checkbox-mixedmark {
    transform: scaleX(1) rotate(-45deg);
  }
}

.vdl-checkbox-indeterminate {
  .vdl-checkbox-checkmark {
    opacity: 0;
    transform: rotate(45deg);
  }

  .vdl-checkbox-checkmark-path {
    stroke-dashoffset: 0;
  }

  .vdl-checkbox-mixedmark {
    opacity: 1;
    transform: scaleX(1) rotate(0deg);
  }
}


.vdl-checkbox-unchecked {
  .vdl-checkbox-background {
    background-color: transparent;
  }
}

.vdl-checkbox-disabled {
  cursor: default;
}

.vdl-checkbox-anim {
  $indeterminate-change-duration: 500ms;

  &-unchecked-checked {
    .vdl-checkbox-background {
      animation: $vdl-checkbox-transition-duration * 2 linear 0ms vdl-checkbox-fade-in-background;
    }

    .vdl-checkbox-checkmark-path {
      // Instead of delaying the animation, we simply multiply its length by 2 and begin the
      // animation at 50% in order to prevent a flash of styles applied to a checked checkmark
      // as the background is fading in before the animation begins.
      animation:
        $vdl-checkbox-transition-duration * 2 linear 0ms vdl-checkbox-unchecked-checked-checkmark-path;
    }
  }

  &-unchecked-indeterminate {
    .vdl-checkbox-background {
      animation: $vdl-checkbox-transition-duration * 2 linear 0ms vdl-checkbox-fade-in-background;
    }

    .vdl-checkbox-mixedmark {
      animation:
        $vdl-checkbox-transition-duration linear 0ms vdl-checkbox-unchecked-indeterminate-mixedmark;
    }
  }

  &-checked-unchecked {
    .vdl-checkbox-background {
      animation: $vdl-checkbox-transition-duration * 2 linear 0ms vdl-checkbox-fade-out-background;
    }

    .vdl-checkbox-checkmark-path {
      animation:
        $vdl-checkbox-transition-duration linear 0ms vdl-checkbox-checked-unchecked-checkmark-path;
    }
  }

  &-checked-indeterminate {
    .vdl-checkbox-checkmark {
      animation:
        $vdl-checkbox-transition-duration linear 0ms vdl-checkbox-checked-indeterminate-checkmark;
    }

    .vdl-checkbox-mixedmark {
      animation:
        $vdl-checkbox-transition-duration linear 0ms vdl-checkbox-checked-indeterminate-mixedmark;
    }
  }

  &-indeterminate-checked {
    .vdl-checkbox-checkmark {
      animation:
        $indeterminate-change-duration linear 0ms vdl-checkbox-indeterminate-checked-checkmark;
    }

    .vdl-checkbox-mixedmark {
      animation:
        $indeterminate-change-duration linear 0ms vdl-checkbox-indeterminate-checked-mixedmark;
    }
  }

  &-indeterminate-unchecked {
    .vdl-checkbox-background {
      animation: $vdl-checkbox-transition-duration * 2 linear 0ms vdl-checkbox-fade-out-background;
    }

    .vdl-checkbox-mixedmark {
      animation:
        $indeterminate-change-duration * 0.6 linear 0ms
        vdl-checkbox-indeterminate-unchecked-mixedmark;
    }
  }
}

.vdl-checkbox-input {
  // Move the input to the bottom and in the middle.
  // Visual improvement to properly show browser popups when being required.
  bottom: 0;
  left: 50%;
}

.vdl-checkbox-frame {
  border-color: $checkbox-border-color;
}

.vdl-checkbox-checkmark {
  fill: $checkbox-mark-color;
}

.vdl-checkbox-checkmark-path {
  // !important is needed here because a stroke must be set as an attribute on the SVG in order
  // for line animation to work properly.
  stroke: $checkbox-mark-color !important;
}

.vdl-checkbox-mixedmark {
  background-color: $checkbox-mark-color;
}

[required] .vdl-checkbox-required {
  color: vdl-color(17);
}

.vdl-hint-container {
  line-height: 0.75rem;
  font-size: 0.75rem;
}

.vdl-checkbox-error {
  .vdl-checkbox-frame {
    border-color: vdl-color(17);;
  }
}
.vdl-checkbox-focused {
  .vdl-checkbox-frame {
    border-width: 3px;
    margin: -1px;
  }
}

.vdl-checkbox-disabled {
  &.vdl-checkbox-checked, &.vdl-checkbox-indeterminate {
    .vdl-checkbox-background {
      background-color: $disabled-color;
    }
  }

  &:not(.vdl-checkbox-checked) {
    .vdl-checkbox-frame {
      border-color: $disabled-color;
    }
  }
  .vdl-checkbox-label-container,
  .vdl-hint-container .vdl-hint,
  .vdl-checkbox-required {
    color: $disabled-color;
  }
}
